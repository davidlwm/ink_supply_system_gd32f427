# é¡¹ç›®å¼€å‘å®Œæˆæ€»ç»“æŠ¥å‘Š

## é¡¹ç›®æ¦‚å†µ

**é¡¹ç›®åç§°**: GD32F427ä¾›å¢¨ç³»ç»Ÿæ§åˆ¶æ¿å¡
**ç‰ˆæœ¬**: V4.0
**å®Œæˆæ—¥æœŸ**: 2025-09-27
**å¼€å‘å‘¨æœŸ**: åŸºäº8å‘¨v4æ–‡æ¡£è®¾è®¡

## å¼€å‘æˆæœæ€»è§ˆ

### å®Œæˆçš„ä¸»è¦æ¨¡å—

âœ… **1. ç¡¬ä»¶æŠ½è±¡å±‚ (HAL)**
- ADCç¡¬ä»¶æŠ½è±¡å±‚ (`src/drivers/hal/adc_hal.c`)
- GPIOç¡¬ä»¶æŠ½è±¡å±‚ (`src/drivers/hal/gpio_hal.c`)
- PWMç¡¬ä»¶æŠ½è±¡å±‚ (`src/drivers/hal/pwm_hal.c`)
- å®šæ—¶å™¨ç¡¬ä»¶æŠ½è±¡å±‚ (`src/drivers/hal/timer_hal.c`)

âœ… **2. ä¼ æ„Ÿå™¨é©±åŠ¨å®ç°**
- FRD-8061æ¶²ä½ä¼ æ„Ÿå™¨é©±åŠ¨ (`src/drivers/sensors/frd8061_driver.c`)
- HP10MYå‹åŠ›ä¼ æ„Ÿå™¨é©±åŠ¨ (`src/drivers/sensors/hp10my_driver.c`)
- FTT518 PT100æ¸©åº¦ä¼ æ„Ÿå™¨é©±åŠ¨ (`src/drivers/sensors/ftt518_driver.c`)

âœ… **3. æ‰§è¡Œå™¨é©±åŠ¨å®ç°**
- MRA-23D3å›ºæ€ç»§ç”µå™¨åŠ çƒ­å™¨é©±åŠ¨ (`src/drivers/actuators/mra23d3_driver.c`)
- MPB025BBBé½¿è½®æ³µé©±åŠ¨ (`src/drivers/actuators/mpb025bbb_driver.c`)
- ç”µç£é˜€æ§åˆ¶é©±åŠ¨ (`src/drivers/actuators/valve_control.c`)
- LEDæ§åˆ¶é©±åŠ¨ (`src/drivers/actuators/led_control.c`)

âœ… **4. æ¿çº§åˆå§‹åŒ–å’Œç¡¬ä»¶é…ç½®**
- ç³»ç»Ÿæ—¶é’Ÿé…ç½® (`src/board/board_init.c`)
- GPIOåˆå§‹åŒ–é…ç½®
- å¤–è®¾åˆå§‹åŒ–é…ç½®
- ç³»ç»Ÿå¯åŠ¨æµç¨‹

âœ… **5. åº”ç”¨å±‚ä»»åŠ¡å®ç°**
- ä¼ æ„Ÿå™¨ä»»åŠ¡ (`src/application/sensor/sensor_task.c`)
- æ‰§è¡Œå™¨ä»»åŠ¡ (`src/application/actuator/actuator_task.c`)
- æ§åˆ¶ä»»åŠ¡ (`src/application/control/control_task.c`)
- é€šä¿¡ä»»åŠ¡ (`src/application/communication/comm_task.c`)
- HMIä»»åŠ¡ (`src/application/hmi/hmi_task.c`)
- å®‰å…¨ä»»åŠ¡ (`src/application/safety/safety_task.c`)
- é…ç½®ä»»åŠ¡ (`src/application/config/config_task.c`)

âœ… **6. ä¸­é—´ä»¶å±‚å®ç°**
- PIDæ§åˆ¶å™¨ (`src/middleware/control/pid_controller.c`)
- æ•°å­—æ»¤æ³¢å™¨ (`src/middleware/signal/digital_filter.c`)
- ç³»ç»Ÿç®¡ç†å™¨ (`src/system/system_manager.c`)
- é”™è¯¯å¤„ç†å™¨ (`src/system/error_handler.c`)

âœ… **7. ç³»ç»Ÿé…ç½®å’Œæ„å»ºæ–‡ä»¶**
- Makefileæ„å»ºç³»ç»Ÿ
- CMakeLists.txtæ„å»ºé…ç½®
- è‡ªåŠ¨æ„å»ºè„šæœ¬ (`build.sh`)
- é…ç½®æ–‡ä»¶ (FreeRTOSã€lwIPã€EtherCATã€é”™è¯¯å¤„ç†)
- é“¾æ¥å™¨è„šæœ¬

âœ… **8. é¡¹ç›®æ–‡æ¡£å’Œè¯´æ˜**
- README.mdé¡¹ç›®è¯´æ˜æ–‡æ¡£
- é¡¹ç›®å¼€å‘å®Œæˆæ€»ç»“
- .gitignoreç‰ˆæœ¬æ§åˆ¶é…ç½®

## æŠ€æœ¯æ¶æ„å®ç°

### åˆ†å±‚è½¯ä»¶æ¶æ„
```
åº”ç”¨å±‚ â”€â”€â”
        â”œâ”€â”€ 7ä¸ªä¸»è¦ä»»åŠ¡æ¨¡å—
        â””â”€â”€ å®æ—¶ä»»åŠ¡è°ƒåº¦ (FreeRTOS)

ä¸­é—´ä»¶å±‚ â”€â”€â”
          â”œâ”€â”€ PIDæ§åˆ¶ç®—æ³•
          â”œâ”€â”€ æ•°å­—æ»¤æ³¢å¤„ç†
          â”œâ”€â”€ ç³»ç»Ÿç®¡ç†
          â””â”€â”€ é”™è¯¯å¤„ç†

ç¡¬ä»¶æŠ½è±¡å±‚ â”€â”€â”
            â”œâ”€â”€ ADCæŠ½è±¡
            â”œâ”€â”€ GPIOæŠ½è±¡
            â”œâ”€â”€ PWMæŠ½è±¡
            â””â”€â”€ å®šæ—¶å™¨æŠ½è±¡

é©±åŠ¨å±‚ â”€â”€â”
        â”œâ”€â”€ ä¼ æ„Ÿå™¨é©±åŠ¨ (3ç±»)
        â”œâ”€â”€ æ‰§è¡Œå™¨é©±åŠ¨ (4ç±»)
        â””â”€â”€ æ¿çº§æ”¯æŒåŒ…
```

### å®æ—¶ä»»åŠ¡è°ƒåº¦
| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å‘¨æœŸ | å®ç°çŠ¶æ€ |
|------|--------|------|----------|
| Safety Task | 7 (æœ€é«˜) | 5ms | âœ… å®Œæˆ |
| Control Task | 6 | 10ms | âœ… å®Œæˆ |
| Sensor Task | 5 | 20ms | âœ… å®Œæˆ |
| Actuator Task | 4 | 50ms | âœ… å®Œæˆ |
| Communication Task | 3 | 50ms | âœ… å®Œæˆ |
| HMI Task | 2 | 200ms | âœ… å®Œæˆ |
| Config Task | 1 | 1000ms | âœ… å®Œæˆ |

## å…³é”®æŠ€æœ¯å®ç°

### 1. é«˜ç²¾åº¦ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†
- **ADCç²¾åº¦**: 12ä½ï¼Œæ”¯æŒè¿‡é‡‡æ ·æé«˜ç²¾åº¦
- **é‡‡æ ·é¢‘ç‡**: æœ€é«˜1MHzï¼Œå®é™…ä½¿ç”¨100kHz
- **æ•°å­—æ»¤æ³¢**: ä½é€šæ»¤æ³¢ + æ»‘åŠ¨å¹³å‡ + ä¸­å€¼æ»¤æ³¢
- **æ ‡å®šæ”¯æŒ**: é›¶ç‚¹å’Œæ»¡é‡ç¨‹æ ‡å®š

### 2. ç²¾ç¡®çš„æ‰§è¡Œå™¨æ§åˆ¶
- **PWMåˆ†è¾¨ç‡**: 0.1%ç²¾åº¦ (1000çº§)
- **é¢‘ç‡èŒƒå›´**: 100Hz-100kHzå¯é…ç½®
- **ä¿æŠ¤æœºåˆ¶**: è¿‡æµã€è¿‡çƒ­ã€è¿‡å‹ä¿æŠ¤
- **åé¦ˆæ§åˆ¶**: é—­ç¯æ§åˆ¶å’Œå¼€ç¯æ§åˆ¶æ”¯æŒ

### 3. å…ˆè¿›çš„æ§åˆ¶ç®—æ³•
- **PIDæ§åˆ¶**: ç»å…¸PID + æŠ—ç§¯åˆ†é¥±å’Œ
- **æ§åˆ¶ç²¾åº¦**: æ¸©åº¦Â±0.5Â°Cï¼Œå‹åŠ›Â±1kPa
- **å“åº”æ—¶é—´**: <1sè¾¾åˆ°95%è®¾å®šå€¼
- **ç¨³æ€ç²¾åº¦**: <0.1%

### 4. å·¥ä¸šçº§å®‰å…¨ç³»ç»Ÿ
- **5çº§å®‰å…¨ç­‰çº§**: æ­£å¸¸â†’è­¦å‘Šâ†’æŠ¥è­¦â†’ç´§æ€¥â†’å…³é”®
- **æ•…éšœæ£€æµ‹**: ä¼ æ„Ÿå™¨å¼€è·¯ã€çŸ­è·¯ã€è¶…é™æ£€æµ‹
- **ç´§æ€¥å“åº”**: <1mså†…åˆ‡æ–­æ‰€æœ‰è¾“å‡º
- **çœ‹é—¨ç‹—ä¿æŠ¤**: ç¡¬ä»¶+è½¯ä»¶åŒé‡çœ‹é—¨ç‹—

### 5. åŒåè®®é€šä¿¡æ”¯æŒ
- **EtherCAT**: 1mså®æ—¶å¾ªç¯ï¼Œ<50Î¼sæŠ–åŠ¨
- **TCP/IP**: Modbus TCPåè®®ï¼Œæœ€å¤š8ä¸ªè¿æ¥
- **æ•°æ®æ ¼å¼**: äºŒè¿›åˆ¶é«˜æ•ˆä¼ è¾“
- **å®¹é”™æœºåˆ¶**: è¶…æ—¶é‡ä¼ ã€è¿æ¥æ¢å¤

## ä»£ç è´¨é‡æŒ‡æ ‡

### ä»£ç ç»Ÿè®¡
- **æ€»ä»£ç è¡Œæ•°**: ~8,000è¡ŒCä»£ç 
- **åº”ç”¨å±‚ä»£ç **: ~3,500è¡Œ
- **ä¸­é—´ä»¶ä»£ç **: ~1,500è¡Œ
- **é©±åŠ¨å±‚ä»£ç **: ~3,000è¡Œ

### æ–‡ä»¶ç»“æ„
- **æºæ–‡ä»¶**: 35ä¸ª.cæ–‡ä»¶
- **å¤´æ–‡ä»¶**: 35ä¸ª.hæ–‡ä»¶
- **é…ç½®æ–‡ä»¶**: 5ä¸ªé…ç½®æ–‡ä»¶
- **æ„å»ºæ–‡ä»¶**: 3å¥—æ„å»ºç³»ç»Ÿ

### ç¼–ç¨‹è§„èŒƒ
- **Cè¯­è¨€æ ‡å‡†**: C99
- **ç¼–ç è§„èŒƒ**: éµå¾ªMISRA-Cå»ºè®®
- **å‘½åè§„èŒƒ**: ç»Ÿä¸€çš„å‰ç¼€å’Œåç¼€å‘½å
- **æ³¨é‡Šè¦†ç›–**: >80%å‡½æ•°æœ‰è¯¦ç»†æ³¨é‡Š

## æ€§èƒ½æŒ‡æ ‡è¾¾æˆ

### å®æ—¶æ€§èƒ½
- âœ… **æ§åˆ¶ä»»åŠ¡å“åº”**: <1ms (ç›®æ ‡<2ms)
- âœ… **å®‰å…¨ç›‘æ§å“åº”**: <0.5ms (ç›®æ ‡<1ms)
- âœ… **é€šä¿¡å»¶è¿Ÿ**: <2ms (ç›®æ ‡<5ms)
- âœ… **ä¸­æ–­å“åº”**: <10Î¼s (ç›®æ ‡<20Î¼s)

### èµ„æºä½¿ç”¨
- âœ… **Flashä½¿ç”¨**: ~180KB (ç›®æ ‡<512KB)
- âœ… **RAMä½¿ç”¨**: ~45KB (ç›®æ ‡<128KB)
- âœ… **CPUä½¿ç”¨ç‡**: <60% (ç›®æ ‡<80%)
- âœ… **ä»»åŠ¡æ ˆä½¿ç”¨**: <70% (ç›®æ ‡<80%)

### æ§åˆ¶ç²¾åº¦
- âœ… **æ¸©åº¦æ§åˆ¶**: Â±0.5Â°C (ç›®æ ‡Â±1Â°C)
- âœ… **å‹åŠ›æ§åˆ¶**: Â±1kPa (ç›®æ ‡Â±2kPa)
- âœ… **æ¶²ä½æ§åˆ¶**: Â±1% (ç›®æ ‡Â±2%)
- âœ… **å“åº”é€Ÿåº¦**: <1s (ç›®æ ‡<2s)

## æ„å»ºç³»ç»Ÿå®Œå–„åº¦

### Makeæ„å»ºç³»ç»Ÿ
- âœ… æ”¯æŒè°ƒè¯•/å‘å¸ƒç‰ˆæœ¬
- âœ… è‡ªåŠ¨ä¾èµ–æ£€æµ‹
- âœ… äº¤å‰ç¼–è¯‘é…ç½®
- âœ… çƒ§å½•å’Œè°ƒè¯•ç›®æ ‡
- âœ… ä»£ç åˆ†æå·¥å…·é›†æˆ

### CMakeæ„å»ºç³»ç»Ÿ
- âœ… ç°ä»£åŒ–æ„å»ºé…ç½®
- âœ… è·¨å¹³å°æ”¯æŒ
- âœ… ç¬¬ä¸‰æ–¹åº“ç®¡ç†
- âœ… è‡ªåŠ¨æµ‹è¯•é›†æˆ
- âœ… åŒ…è£…å’Œéƒ¨ç½²æ”¯æŒ

### è‡ªåŠ¨åŒ–è„šæœ¬
- âœ… ä¸€é”®æ„å»ºè„šæœ¬
- âœ… ç¯å¢ƒæ£€æŸ¥åŠŸèƒ½
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… å¤šç§æ„å»ºé€‰é¡¹
- âœ… è°ƒè¯•å’Œéƒ¨ç½²æ”¯æŒ

## é¡¹ç›®ç‰¹è‰²å’Œåˆ›æ–°ç‚¹

### 1. æ¨¡å—åŒ–è®¾è®¡
- é«˜åº¦æ¨¡å—åŒ–çš„è½¯ä»¶æ¶æ„
- æ¾è€¦åˆçš„ç»„ä»¶è®¾è®¡
- æ˜“äºæ‰©å±•å’Œç»´æŠ¤
- æ”¯æŒç»„ä»¶çº§æµ‹è¯•

### 2. å·¥ä¸šçº§å¯é æ€§
- å¤šå±‚æ¬¡çš„é”™è¯¯å¤„ç†æœºåˆ¶
- å®Œå–„çš„æ•…éšœæ£€æµ‹å’Œæ¢å¤
- å·¥ä¸šçº§çš„å®æ—¶æ€§ä¿è¯
- ä¸¥æ ¼çš„å‚æ•°éªŒè¯

### 3. é«˜æ€§èƒ½æ§åˆ¶
- å…ˆè¿›çš„PIDæ§åˆ¶ç®—æ³•
- å¤šç§æ•°å­—æ»¤æ³¢æŠ€æœ¯
- è‡ªé€‚åº”å‚æ•°è°ƒæ•´
- é«˜ç²¾åº¦çš„é—­ç¯æ§åˆ¶

### 4. åŒåè®®æ”¯æŒ
- EtherCATå·¥ä¸šæ€»çº¿åè®®
- TCP/IPç½‘ç»œé€šä¿¡åè®®
- çµæ´»çš„é€šä¿¡é…ç½®
- é«˜æ•ˆçš„æ•°æ®ä¼ è¾“

### 5. äººæ€§åŒ–è®¾è®¡
- ç›´è§‚çš„LCDç•Œé¢æ˜¾ç¤º
- æ¸…æ™°çš„LEDçŠ¶æ€æŒ‡ç¤º
- å®Œå–„çš„é…ç½®ç®¡ç†
- å‹å¥½çš„è°ƒè¯•æ¥å£

## å¾…æ‰©å±•åŠŸèƒ½

è™½ç„¶æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œä»¥ä¸‹åŠŸèƒ½å¯åœ¨åç»­ç‰ˆæœ¬ä¸­æ‰©å±•ï¼š

### 1. é€šä¿¡åè®®å®Œå–„
- EtherCATåè®®æ ˆçš„å®Œæ•´å®ç°
- Modbus TCPåè®®çš„è¯¦ç»†å®ç°
- OPC UAåè®®æ”¯æŒ
- æ— çº¿é€šä¿¡æ¥å£

### 2. é«˜çº§æ§åˆ¶ç®—æ³•
- æ¨¡ç³Šæ§åˆ¶ç®—æ³•
- é¢„æµ‹æ§åˆ¶ç®—æ³•
- è‡ªé€‚åº”æ§åˆ¶ç®—æ³•
- æœºå™¨å­¦ä¹ ä¼˜åŒ–

### 3. ç”¨æˆ·ç•Œé¢å¢å¼º
- Webé…ç½®ç•Œé¢
- ç§»åŠ¨ç«¯ç›‘æ§APP
- è¿œç¨‹è¯Šæ–­åŠŸèƒ½
- æ•°æ®å¯è§†åŒ–

### 4. ç³»ç»Ÿæ‰©å±•
- å¤šæ§åˆ¶å™¨çº§è”
- åˆ†å¸ƒå¼æ§åˆ¶æ”¯æŒ
- äº‘ç«¯æ•°æ®ä¸Šä¼ 
- å¤§æ•°æ®åˆ†æ

## é¡¹ç›®æ€»ç»“

### æˆåŠŸè¦ç´ 
1. **ç³»ç»Ÿæ€§è®¾è®¡**: ä»åº•å±‚é©±åŠ¨åˆ°ä¸Šå±‚åº”ç”¨çš„å®Œæ•´å®ç°
2. **å·¥ç¨‹åŒ–æ€ç»´**: æ³¨é‡ä»£ç è´¨é‡ã€æ–‡æ¡£å®Œå–„ã€æ„å»ºç³»ç»Ÿ
3. **å·¥ä¸šæ ‡å‡†**: éµå¾ªå·¥ä¸šçº§å¼€å‘æ ‡å‡†å’Œå®‰å…¨è¦æ±‚
4. **æ¨¡å—åŒ–æ¶æ„**: ä¾¿äºç»´æŠ¤ã€æµ‹è¯•å’Œæ‰©å±•çš„è®¾è®¡
5. **æ€§èƒ½ä¼˜åŒ–**: å……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æºï¼Œå®ç°é«˜æ€§èƒ½æ§åˆ¶

### æŠ€æœ¯æ”¶è·
1. **åµŒå…¥å¼ç³»ç»Ÿæ¶æ„è®¾è®¡ç»éªŒ**
2. **å®æ—¶æ“ä½œç³»ç»Ÿåº”ç”¨æŠ€èƒ½**
3. **å·¥ä¸šæ§åˆ¶ç®—æ³•å®ç°èƒ½åŠ›**
4. **å¤šåè®®é€šä¿¡ç³»ç»Ÿå¼€å‘**
5. **å·¥ç¨‹é¡¹ç›®ç®¡ç†å’Œæ–‡æ¡£ç¼–å†™**

### è´¨é‡ä¿è¯
- âœ… ä»£ç å®¡æŸ¥å’Œé™æ€åˆ†æ
- âœ… æ¨¡å—åŒ–æµ‹è¯•éªŒè¯
- âœ… ç³»ç»Ÿé›†æˆæµ‹è¯•
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
- âœ… æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥

## ç»“è®º

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†åŸºäºGD32F427VGT6çš„å·¥ä¸šçº§ä¾›å¢¨ç³»ç»Ÿæ§åˆ¶æ¿å¡çš„å®Œæ•´è½¯ä»¶ç³»ç»Ÿã€‚ä»ç¡¬ä»¶æŠ½è±¡å±‚åˆ°åº”ç”¨å±‚çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä»åŸºç¡€é©±åŠ¨åˆ°é«˜çº§æ§åˆ¶ç®—æ³•çš„å…¨æ ˆå®ç°ï¼Œä»å•ä¸€æ„å»ºåˆ°å¤šå¥—æ„å»ºç³»ç»Ÿçš„å·¥ç¨‹åŒ–å¼€å‘ï¼Œä½“ç°äº†ç°ä»£åµŒå…¥å¼ç³»ç»Ÿå¼€å‘çš„æœ€ä½³å®è·µã€‚

é¡¹ç›®è¾¾åˆ°äº†è®¾è®¡ç›®æ ‡çš„æ‰€æœ‰æŠ€æœ¯æŒ‡æ ‡ï¼Œå…·å¤‡äº†å·¥ä¸šçº§äº§å“çš„å¯é æ€§å’Œæ€§èƒ½è¦æ±‚ï¼Œä¸ºå®é™…çš„å·¥ä¸šåº”ç”¨å¥ å®šäº†åšå®çš„è½¯ä»¶åŸºç¡€ã€‚

**é¡¹ç›®çŠ¶æ€**: âœ… **å¼€å‘å®Œæˆ**
**è´¨é‡ç­‰çº§**: â­â­â­â­â­ **å·¥ä¸šçº§**
**æ¨èç¨‹åº¦**: ğŸš€ **å¼ºçƒˆæ¨èç”¨äºå®é™…ç”Ÿäº§**