# 墨水供应系统 - 简化模板工程

## 项目概述
基于 **IIC实验** 创建的墨水供应系统开发模板。这个模板结构简洁明了，依赖关系清晰，非常适合作为起点逐步添加功能。

## 🏗️ 工程结构

```
ink_supply_template_simple/
├── CORE/                          # ARM Cortex-M4 内核文件
├── HALLIB/                        # GD32F4xx HAL库
│   └── STM32F4xx_HAL_Driver/     # HAL驱动库
├── HARDWARE/                      # 硬件驱动层
│   ├── 24CXX/                    # EEPROM驱动
│   ├── IIC/                      # I2C驱动
│   ├── KEY/                      # 按键驱动
│   ├── LCD/                      # LCD显示驱动
│   └── LED/                      # LED驱动
├── SYSTEM/                        # 系统层驱动
│   ├── delay/                    # 延时函数
│   ├── sys/                      # 系统配置
│   └── usart/                    # 串口驱动
├── USER/                          # 用户代码
│   ├── main.c                    # 主程序 (已简化)
│   └── InkSupplySystem.uvprojx   # Keil工程文件
├── USMART/                        # USMART调试组件
└── readme.txt                    # 原始说明文件
```

## 🔧 硬件资源

### 基础硬件
- **MCU**: GD32F427VET6 (168MHz)
- **Flash**: 512KB
- **SRAM**: 256KB
- **时钟**: 168MHz系统时钟

### 当前可用外设
1. **LED**: LED0 (PA1) - 系统运行指示
2. **按键**:
   - KEY0 (PC0) - 演示功能触发
   - WKUP (PA0) - 系统测试模式
3. **串口**: USART1 (PA9/PA10, 115200波特率)
4. **LCD**: TFT LCD显示屏 (FSMC接口)
5. **存储器**: 24C02 EEPROM (I2C接口: PB8/PB9)
6. **调试**: USMART调试系统

## ⭐ 主要特性

### ✅ 已实现功能
- 🎯 **基础系统初始化**: HAL库、时钟、外设初始化
- 📟 **LCD显示**: 系统信息显示，状态提示
- ⌨️ **按键检测**: 两个按键的功能定义
- 💾 **EEPROM支持**: 24C02检测和基础读写
- 📡 **串口调试**: 115200波特率，支持printf输出
- 🔄 **系统监控**: LED闪烁指示，运行状态输出
- 🛠️ **调试工具**: USMART命令行调试系统

### 📋 代码结构特点
- **模块化设计**: 清晰的系统初始化和显示分离
- **易于扩展**: 预留了测试模式和演示功能接口
- **状态监控**: 系统计数器和定时状态输出
- **错误处理**: 24C02检测失败的提示和处理

## 🚀 使用说明

### 开发环境
- **IDE**: Keil MDK-ARM 5.x
- **编译器**: ARMCC
- **调试器**: 支持ST-Link, J-Link等

### 快速开始
1. **打开工程**
   ```
   使用Keil MDK打开: USER/InkSupplySystem.uvprojx
   ```

2. **编译工程**
   - 直接编译，无需额外配置
   - 所有依赖已正确设置

3. **烧录运行**
   - 连接调试器烧录到GD32F427VET6
   - 观察LCD显示和串口输出

### 按键功能
- **WKUP键**: 激活系统测试模式
  - LCD显示: "System Test Mode"
  - 串口输出: "WKUP Key: System test mode activated"
  - 预留扩展: 添加系统诊断和测试代码

- **KEY0键**: 触发演示功能
  - LCD显示: "Demo Function"
  - 串口输出: "KEY0 Key: Demo function triggered"
  - 预留扩展: 添加功能演示代码

### 系统状态
- **LED0闪烁**: 每500ms闪烁一次，指示系统正常运行
- **串口状态**: 每5秒输出一次系统运行状态
- **24C02检测**: 启动时自动检测EEPROM连接状态

## 🔨 扩展开发指南

### 推荐的扩展步骤

1. **添加传感器驱动**
   ```c
   // 在HARDWARE目录下添加新的传感器驱动
   // 例如: HARDWARE/SENSOR/sensor.c
   ```

2. **扩展按键功能**
   ```c
   // 在main.c的按键处理中添加具体功能
   if (key == WKUP_PRES) {
       // 添加墨水液位检测代码
   }
   if (key == KEY0_PRES) {
       // 添加泵控制演示代码
   }
   ```

3. **利用现有驱动**
   - **EEPROM存储**: 使用24C02保存配置参数
   - **LCD显示**: 创建用户界面
   - **串口通信**: 与上位机通信
   - **I2C接口**: 连接更多I2C设备

### 可添加的功能模块
- 🌊 **液位传感器**: ADC读取液位信号
- ⚙️ **泵控制**: PWM控制墨水泵
- 📊 **数据记录**: 使用EEPROM记录运行数据
- 🌐 **通信接口**: UART/SPI/I2C设备扩展
- ⚡ **电源管理**: 低功耗模式和电源监控
- 🔔 **报警系统**: 故障检测和报警提示

## 📁 关键文件说明

- **`USER/main.c`**: 主程序文件，包含系统初始化和主循环
- **`USER/InkSupplySystem.uvprojx`**: Keil工程配置文件
- **`HARDWARE/`**: 各外设驱动，可直接使用
- **`SYSTEM/`**: 系统层函数，提供基础支持

## 🔄 版本管理

### 当前版本: v1.0
- ✅ 基于IIC实验的基础模板
- ✅ 简化的main.c入口
- ✅ 完整的驱动支持
- ✅ 清晰的扩展接口

### 后续版本规划
- v1.1: 添加ADC驱动支持
- v1.2: 添加PWM驱动支持
- v1.3: 添加实时时钟支持
- v2.0: 完整的墨水供应系统功能

## 💡 开发建议

1. **渐进式开发**: 基于现有模板逐步添加功能，保持代码简洁
2. **模块化设计**: 每个新功能独立成模块，便于调试和维护
3. **充分测试**: 利用现有的按键和显示系统进行功能测试
4. **文档更新**: 添加新功能时及时更新文档

## 📞 技术支持

如果在使用过程中遇到问题，可以：
1. 检查硬件连接是否正确
2. 确认Keil工程配置
3. 查看串口调试输出
4. 参考原始IIC实验代码

---

**模板特点**: 简洁、可控、易扩展
**适用场景**: 墨水供应系统开发，嵌入式学习，功能原型验证