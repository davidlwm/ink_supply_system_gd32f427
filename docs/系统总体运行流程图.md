# 供墨系统运行流程思维导图

## 1. 系统总体运行流程

```mermaid
graph TD
    A[系统上电] --> B[硬件初始化]
    B --> C[FreeRTOS启动]
    C --> D[中间件初始化]
    D --> E[应用层初始化]
    E --> F[任务创建启动]
    F --> G[系统运行状态]

    G --> H[安全任务]
    G --> I[控制任务]
    G --> J[传感器任务]
    G --> K[执行器任务]
    G --> L[通信任务]
    G --> M[HMI任务]
    G --> N[配置任务]

    H --> O[安全检查循环]
    I --> P[控制算法循环]
    J --> Q[数据采集循环]
    K --> R[执行器管理循环]
    L --> S[通信处理循环]
    M --> T[界面更新循环]
    N --> U[配置管理循环]

    O --> V{检测到故障?}
    V -->|是| W[故障处理]
    V -->|否| O
    W --> X[安全动作]
    X --> Y[故障恢复]
    Y --> O

    P --> Z{控制使能?}
    Z -->|是| AA[PID计算]
    Z -->|否| BB[输出关闭]
    AA --> CC[执行器控制]
    BB --> P
    CC --> P

    Q --> DD[传感器读取]
    DD --> EE[数据滤波]
    EE --> FF[数据校准]
    FF --> GG[故障检测]
    GG --> Q

    R --> HH[状态监控]
    HH --> II[输出执行]
    II --> JJ[反馈检查]
    JJ --> R

    S --> KK[协议解析]
    KK --> LL[数据处理]
    LL --> MM[响应发送]
    MM --> S

    T --> NN[状态显示]
    NN --> OO[按键检测]
    OO --> PP[界面切换]
    PP --> T

    U --> QQ[参数读取]
    QQ --> RR[配置更新]
    RR --> SS[参数保存]
    SS --> U
```

## 2. 详细流程说明

### 2.1 系统启动阶段
1. **上电复位** → **时钟配置** → **GPIO初始化** → **外设初始化**
2. **FreeRTOS内核启动** → **堆栈配置** → **调度器启动**
3. **中间件模块注册** → **HAL层初始化** → **驱动层初始化**
4. **应用任务创建** → **任务优先级设置** → **任务启动**

### 2.2 运行阶段
1. **多任务并发执行**
2. **实时数据采集与处理**
3. **闭环控制算法执行**
4. **安全监控与保护**
5. **通信数据交换**
6. **人机交互处理**

### 2.3 异常处理阶段
1. **故障检测与诊断**
2. **安全保护动作**
3. **系统恢复与重启**
4. **故障记录与报警**
```
